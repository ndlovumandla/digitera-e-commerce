{% extends "base.html" %}
{% load static %}

{% block title %}Edit Product - {{ product.name }} - Digitera{% endblock %}

{% block extra_head %}
<style>
.creator-dashboard {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    min-height: 100vh;
    padding: 2rem 0;
}

.form-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    margin-bottom: 2rem;
    border: none;
}

.form-card .card-header {
    background: linear-gradient(135deg, #3B82F6 0%, #1d4ed8 100%);
    color: white;
    border-radius: 12px 12px 0 0;
    padding: 1.5rem;
    border: none;
}

.btn-gradient {
    background: linear-gradient(135deg, #3B82F6 0%, #1d4ed8 100%);
    border: none;
    color: white;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.btn-gradient:hover {
    background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
    color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
}

.file-upload-zone {
    border: 2px dashed #cbd5e1;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    background: #f8fafc;
    transition: all 0.3s ease;
    cursor: pointer;
}

.file-upload-zone:hover {
    border-color: #3B82F6;
    background: #f1f5f9;
}
</style>
{% endblock %}

{% block content %}
<div class="creator-dashboard">
    <div class="container">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="h2 mb-2">Edit Product</h1>
                        <p class="text-muted">Update your product information and settings</p>
                    </div>
                    <a href="{% url 'products:creator_list' %}" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Back to Products
                    </a>
                </div>
            </div>
        </div>

        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div class="row">
                <div class="col-lg-8">
                    <!-- Basic Information -->
                    <div class="card form-card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>Basic Information
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if form.non_field_errors %}
                                <div class="alert alert-danger">
                                    {{ form.non_field_errors }}
                                </div>
                            {% endif %}
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="{{ form.name.id_for_label }}" class="form-label fw-semibold">
                                        Product Name<span class="text-danger">*</span>
                                    </label>
                                    {{ form.name }}
                                    {% if form.name.errors %}
                                        <div class="text-danger mt-1 small">{{ form.name.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.price.id_for_label }}" class="form-label fw-semibold">
                                        Price (R)<span class="text-danger">*</span>
                                    </label>
                                    {{ form.price }}
                                    {% if form.price.errors %}
                                        <div class="text-danger mt-1 small">{{ form.price.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.description.id_for_label }}" class="form-label fw-semibold">
                                    Description<span class="text-danger">*</span>
                                </label>
                                {{ form.description }}
                                {% if form.description.errors %}
                                    <div class="text-danger mt-1 small">{{ form.description.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.category.id_for_label }}" class="form-label fw-semibold">
                                        Category
                                    </label>
                                    {{ form.category }}
                                    {% if form.category.errors %}
                                        <div class="text-danger mt-1 small">{{ form.category.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.tags.id_for_label }}" class="form-label fw-semibold">
                                        Tags
                                    </label>
                                    {{ form.tags }}
                                    {% if form.tags.errors %}
                                        <div class="text-danger mt-1 small">{{ form.tags.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Digital Download Settings -->
                    {% if download_form %}
                    <div class="card form-card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-download me-2"></i>Digital Download Settings
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ download_form.delivery_method.id_for_label }}" class="form-label fw-semibold">
                                        Delivery Method
                                    </label>
                                    {{ download_form.delivery_method }}
                                    {% if download_form.delivery_method.errors %}
                                        <div class="text-danger mt-1 small">{{ download_form.delivery_method.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="{{ download_form.download_limit.id_for_label }}" class="form-label fw-semibold">
                                        Download Limit
                                    </label>
                                    {{ download_form.download_limit }}
                                    {% if download_form.download_limit.errors %}
                                        <div class="text-danger mt-1 small">{{ download_form.download_limit.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="{{ download_form.expiry_days.id_for_label }}" class="form-label fw-semibold">
                                        Expiry Days
                                    </label>
                                    {{ download_form.expiry_days }}
                                    {% if download_form.expiry_days.errors %}
                                        <div class="text-danger mt-1 small">{{ download_form.expiry_days.errors.0 }}</div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    <label for="{{ download_form.license_type.id_for_label }}" class="form-label fw-semibold">
                                        License Type
                                    </label>
                                    {{ download_form.license_type }}
                                    {% if download_form.license_type.errors %}
                                        <div class="text-danger mt-1 small">{{ download_form.license_type.errors.0 }}</div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Sidebar -->
                <div class="col-lg-4">
                    <!-- Publishing Options -->
                    <div class="card form-card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-cog me-2"></i>Publishing
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="{{ form.status.id_for_label }}" class="form-label fw-semibold">
                                    Status
                                </label>
                                {{ form.status }}
                                {% if form.status.errors %}
                                    <div class="text-danger mt-1 small">{{ form.status.errors.0 }}</div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                <label for="{{ form.visibility.id_for_label }}" class="form-label fw-semibold">
                                    Visibility
                                </label>
                                {{ form.visibility }}
                                {% if form.visibility.errors %}
                                    <div class="text-danger mt-1 small">{{ form.visibility.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Featured Image -->
                    <div class="card form-card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-image me-2"></i>Featured Image
                            </h5>
                        </div>
                        <div class="card-body">
                            {% if product.featured_image %}
                                <div class="text-center mb-3">
                                    <img src="{{ product.featured_image.url }}" 
                                         alt="{{ product.name }}" 
                                         class="img-fluid rounded"
                                         style="max-height: 200px;">
                                </div>
                            {% endif %}
                            
                            <div class="file-upload-zone">
                                <i class="fas fa-image text-muted mb-2" style="font-size: 2rem;"></i>
                                <p class="mb-2"><strong>Click to upload</strong> or drag and drop</p>
                                <p class="text-muted small mb-0">PNG, JPG up to 5MB</p>
                                {{ form.featured_image }}
                            </div>
                            {% if form.featured_image.errors %}
                                <div class="text-danger mt-1 small">{{ form.featured_image.errors.0 }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="card form-card">
                        <div class="card-body">
                            <div class="d-flex flex-column gap-2">
                                <button type="submit" class="btn btn-gradient">
                                    <i class="fas fa-save me-2"></i>Update Product
                                </button>
                                
                                <a href="{% url 'products:detail' product.pk %}" 
                                   class="btn btn-outline-primary" 
                                   target="_blank">
                                    <i class="fas fa-eye me-2"></i>Preview Product
                                </a>
                                
                                <a href="{% url 'products:creator_duplicate' product.pk %}" 
                                   class="btn btn-outline-secondary">
                                    <i class="fas fa-copy me-2"></i>Duplicate Product
                                </a>
                                
                                <hr>
                                
                                <a href="{% url 'products:creator_delete' product.pk %}" 
                                   class="btn btn-outline-danger"
                                   onclick="return confirm('Are you sure you want to delete this product?')">
                                    <i class="fas fa-trash me-2"></i>Delete Product
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // File upload styling
    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
        const uploadZone = input.closest('.file-upload-zone');
        if (uploadZone) {
            input.style.position = 'absolute';
            input.style.opacity = '0';
            input.style.width = '100%';
            input.style.height = '100%';
            input.style.cursor = 'pointer';
        }
    });

    // Form validation
    const form = document.querySelector('form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('is-invalid');
                } else {
                    field.classList.remove('is-invalid');
                }
            });

            if (!isValid) {
                e.preventDefault();
                alert('Please fill in all required fields.');
            }
        });
    }
});
</script>
{% endblock %}
