{% extends 'base.html' %}
{% load humanize %}

{% block title %}Search Results - Digitera{% endblock %}

{% block content %}
<div class="bg-white">
    <!-- Search Header -->
    <div class="bg-gray-50 border-b border-gray-200">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                <div class="flex-1">
                    <h1 class="text-2xl font-bold text-gray-900">
                        {% if query %}
                            Search results for "{{ query }}"
                        {% else %}
                            All Products
                        {% endif %}
                    </h1>
                    <p class="mt-1 text-sm text-gray-600">
                        {% if products %}
                            Showing {{ products|length }} of {{ total_products }} products
                        {% else %}
                            No products found
                        {% endif %}
                    </p>
                </div>
                <div class="mt-4 sm:mt-0">
                    <form method="GET" class="flex items-center space-x-2">
                        <input type="text" 
                               name="q" 
                               value="{{ query|default:'' }}"
                               placeholder="Search products..."
                               class="px-4 py-2 border border-gray-300 rounded-md focus:ring-digitera-blue focus:border-digitera-blue">
                        <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-digitera-blue hover:bg-blue-700 focus:ring-2 focus:ring-offset-2 focus:ring-digitera-blue">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Filters and Results -->
    <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
            
            <!-- Sidebar Filters -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg border border-gray-200 p-6 mb-6 lg:mb-0">
                    <h3 class="text-lg font-medium text-gray-900 mb-4">Filters</h3>
                    
                    <!-- Category Filter -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Category</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">Business (1,234)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">Design (987)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">Photography (654)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">Music (432)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">Education (567)</span>
                            </label>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Price Range</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="radio" name="price" class="border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">Free</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="price" class="border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">R1 - R100</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="price" class="border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">R101 - R500</span>
                            </label>
                            <label class="flex items-center">
                                <input type="radio" name="price" class="border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">R501+</span>
                            </label>
                        </div>
                    </div>

                    <!-- Rating Filter -->
                    <div class="mb-6">
                        <h4 class="text-sm font-medium text-gray-900 mb-3">Rating</h4>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">⭐⭐⭐⭐⭐ (5 stars)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">⭐⭐⭐⭐ (4+ stars)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="rounded border-gray-300 text-digitera-blue focus:ring-digitera-blue">
                                <span class="ml-2 text-sm text-gray-600">⭐⭐⭐ (3+ stars)</span>
                            </label>
                        </div>
                    </div>

                    <button class="w-full bg-digitera-blue text-white py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200">
                        Apply Filters
                    </button>
                </div>
            </div>

            <!-- Results Grid -->
            <div class="lg:col-span-3">
                <!-- Sort Options -->
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <span class="text-sm text-gray-500">Sort by:</span>
                        <select class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-digitera-blue focus:border-digitera-blue">
                            <option>Most Popular</option>
                            <option>Newest</option>
                            <option>Price: Low to High</option>
                            <option>Price: High to Low</option>
                            <option>Highest Rated</option>
                        </select>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="p-2 text-gray-400 hover:text-gray-600">
                            <i class="fas fa-th-large"></i>
                        </button>
                        <button class="p-2 text-gray-600">
                            <i class="fas fa-list"></i>
                        </button>
                    </div>
                </div>

                <!-- Products Grid -->
                {% if products %}
                    <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
                        {% for product in products %}
                            <div class="group relative bg-white rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
                                <div class="aspect-w-1 aspect-h-1 w-full overflow-hidden rounded-t-lg">
                                    {% if product.image %}
                                        <img src="{{ product.image.url }}" alt="{{ product.title }}" class="w-full h-48 object-cover group-hover:opacity-75">
                                    {% else %}
                                        <div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                                            <i class="fas fa-image text-gray-400 text-2xl"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            {{ product.category }}
                                        </span>
                                        <div class="flex items-center">
                                            <span class="text-yellow-400">⭐</span>
                                            <span class="text-sm text-gray-600 ml-1">4.5</span>
                                        </div>
                                    </div>
                                    <h3 class="text-lg font-medium text-gray-900 mb-2">
                                        <a href="{% url 'products:detail' product.pk %}" class="hover:text-digitera-blue">
                                            {{ product.title }}
                                        </a>
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-3 line-clamp-2">{{ product.description|truncatewords:15 }}</p>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-lg font-bold text-digitera-blue">
                                                {% if product.price > 0 %}
                                                    R{{ product.price|floatformat:0 }}
                                                {% else %}
                                                    Free
                                                {% endif %}
                                            </span>
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            by {{ product.creator.get_full_name|default:product.creator.username }}
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <a href="{% url 'products:detail' product.pk %}" class="w-full bg-digitera-blue text-white text-center py-2 px-4 rounded-md hover:bg-blue-700 transition duration-200 inline-block">
                                            View Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Pagination -->
                    <div class="mt-12 flex items-center justify-center">
                        <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                            <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">Previous</span>
                                <i class="fas fa-chevron-left"></i>
                            </a>
                            <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">1</a>
                            <a href="#" class="bg-digitera-blue border-digitera-blue text-white relative inline-flex items-center px-4 py-2 border text-sm font-medium">2</a>
                            <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">3</a>
                            <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                <span class="sr-only">Next</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </nav>
                    </div>
                {% else %}
                    <!-- No Results -->
                    <div class="text-center py-12">
                        <i class="fas fa-search text-gray-300 text-6xl mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">No products found</h3>
                        <p class="text-gray-600 mb-6">
                            {% if query %}
                                Try adjusting your search terms or filters.
                            {% else %}
                                No products are available at the moment.
                            {% endif %}
                        </p>
                        <div class="space-x-4">
                            <a href="{% url 'products:marketplace' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-digitera-blue hover:bg-blue-700">
                                Browse All
                            </a>
                            <a href="{% url 'products:categories' %}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                View Categories
                            </a>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
